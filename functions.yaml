# functions.yaml

# --- 1. I2C Bus Configuration for SSD1306 ---
# Keeping this here as it's directly related to the display setup
i2c:
  id: i2c_bus_display
  sda: GPIO4 
  scl: GPIO5
  scan: true

# --- 2. Internal Font Definition ---
font:
  - platform: arial
    id: display_font

# --- 3. SSD1306 Display Component ---
display:
  - platform: ssd1306_i2c
    id: pico_display
    
    model: "SSD1306 128x64"
    
    i2c_id: i2c_bus_display
    address: 0x3C
    
    # Define Constants/Macros for Abstraction
    lambda: |-
      #define LINE_HEIGHT_PIXELS 10
      
      // Macro that prints text starting at Y = (line_num - 1) * LINE_HEIGHT_PIXELS
      #define print_line(line_num, format, ...) \
        it.printf(0, (line_num - 1) * LINE_HEIGHT_PIXELS, id(display_font), format, ##__VA_ARGS__)

      // --- Calculations ---
      float temp_c = id(pico_chip_temperature).state;
      float temp_f = (temp_c * 9.0 / 5.0) + 32.0;

      // --- Display Calls using the Macro ---
      
      // Line 1: IP Address
      print_line(1, id(ip_address_sensor).state.c_str());
      
      // Line 2: Temperature (Using the format string capability of the macro)
      print_line(2, "Chip C/F: %.1fC / %.1fF", temp_c, temp_f);
      
      // Line 3: Placeholder 
      print_line(3, "L3: Start/Stop");
      
      // Line 4: Placeholder
      print_line(4, "L4: Runtime");
      
      // Line 5: Placeholder
      print_line(5, "L5: Oil Pressure");
